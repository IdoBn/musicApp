angular.module("com.2fdevs.videogular",["ngSanitize"]).constant("VG_STATES",{PLAY:"play",PAUSE:"pause",STOP:"stop"}).constant("VG_EVENTS",{ON_PLAY:"onVgPlay",ON_PAUSE:"onVgPause",ON_PLAY_PAUSE:"onVgPlayPause",ON_START_PLAYING:"onVgStartPlaying",ON_COMPLETE:"onVgComplete",ON_SET_STATE:"onVgSetState",ON_SET_VOLUME:"onVgSetVolume",ON_TOGGLE_FULLSCREEN:"onVgToggleFullscreen",ON_ENTER_FULLSCREEN:"onVgEnterFullscreen",ON_EXIT_FULLSCREEN:"onVgExitFullscreen",ON_BUFFERING:"onVgBuffering",ON_UPDATE_TIME:"onVgUpdateTime",
ON_SEEK_TIME:"onVgSeekTime",ON_UPDATE_SIZE:"onVgUpdateSize",ON_UPDATE_THEME:"onVgUpdateTheme",ON_PLAYER_READY:"onVgPlayerReady",ON_LOAD_POSTER:"onVgLoadPoster"}).service("VG_UTILS",function(){this.fixEventOffset=function(b){if(navigator.userAgent.match(/Firefox/i)){var g=b.currentTarget.currentStyle||window.getComputedStyle(b.target,null),e=parseInt(g.borderLeftWidth,10),h=parseInt(g.borderTopWidth,10),g=b.currentTarget.getBoundingClientRect(),h=b.clientY-h-g.top;b.offsetX=b.clientX-e-g.left;b.offsetY=
h}return b};this.getZIndex=function(){var b=1;$("*").filter(function(){return"auto"!==$(this).css("zIndex")}).each(function(){var g=parseInt($(this).css("zIndex"));b<g&&(b=g+1)});return b};this.isMobileDevice=function(){return"undefined"!==typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")};this.isiOSDevice=function(){return navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)}}).run(["$window","VG_UTILS",function(b,g){var e,
h={w3:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",onchange:"fullscreenchange",onerror:"fullscreenerror"},newWebkit:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},oldWebkit:{enabled:"webkitIsFullScreen",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullScreen",exit:"webkitCancelFullScreen",
onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},moz:{enabled:"mozFullScreen",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",onchange:"mozfullscreenchange",onerror:"mozfullscreenerror"},ios:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitEnterFullscreen",exit:void 0,onexit:"webkitendfullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"}},a;for(a in h)if(h[a].enabled in document){e=
h[a];e.isFullScreen=function(){return null!=document[this.element]};break}g.isiOSDevice()&&(e=h.ios,e.isFullScreen=function(){return null!=document[this.element]});angular.element(b)[0].fullScreenAPI=e}]).directive("videogular",["$window","VG_STATES","VG_EVENTS","VG_UTILS",function(b,g,e,h){return{restrict:"E",scope:{playerWidth:"=vgWidth",playerHeight:"=vgHeight",theme:"=vgTheme",autoPlay:"=vgAutoplay",responsive:"=vgResponsive",stretch:"=vgStretch",vgComplete:"&",vgUpdateVolume:"&",vgUpdateTime:"&",
vgUpdateSize:"&",vgUpdateState:"&",vgPlayerReady:"&"},controller:["$scope",function(a){var r=null,k=null,f=null,n=g.STOP,p=a.stretch,l=0,m=0,q=!1,u=!1,v=!1,w=!1,s=!1,t=!1,c=this,x=a.vgComplete(),y=a.vgUpdateVolume(),z=a.vgUpdateTime(),A=a.vgUpdateSize(),B=a.vgUpdateState(),C=a.vgPlayerReady();this.$on=function(){a.$on.apply(a,arguments)};this.isPlayerReady=function(){return s};this.seekTime=function(a){this.videoElement[0].currentTime=a};this.playPause=function(){this.videoElement[0].paused?(this.videoElement[0].play(),
this.setState(g.PLAY),a.$emit(e.ON_PLAY)):(this.videoElement[0].pause(),this.setState(g.PAUSE),a.$emit(e.ON_PAUSE))};this.setState=function(d){d&&d!=n&&(B&&B(d),n=d,a.$emit(e.ON_SET_STATE,[n]));return n};this.play=function(){this.videoElement[0].play();this.setState(g.PLAY);a.$emit(e.ON_PLAY)};this.pause=function(){this.videoElement[0].pause();this.setState(g.PAUSE);a.$emit(e.ON_PAUSE)};this.toggleFullScreen=function(){if(angular.element(b)[0].fullScreenAPI)if(angular.element(b)[0].fullScreenAPI.isFullScreen()){if(!h.isMobileDevice())document[angular.element(b)[0].fullScreenAPI.exit]()}else h.isMobileDevice()?
h.isiOSDevice()?u?this.enterElementInFullScreen(this.videoElement[0]):this.play():this.enterElementInFullScreen(this.videoElement[0]):this.enterElementInFullScreen(this.elementScope[0]);else q?(this.videogularElement.removeClass("fullscreen"),this.videogularElement.css("z-index",0)):(this.videogularElement.addClass("fullscreen"),this.videogularElement.css("z-index",h.getZIndex())),q=!q,a.updateSize()};this.enterElementInFullScreen=function(a){a[angular.element(b)[0].fullScreenAPI.request]()};this.setVolume=
function(d){y&&y(d);this.videoElement[0].volume=d;a.$emit(e.ON_SET_VOLUME,[d])};this.updateTheme=function(a){if(r)for(var c=document.getElementsByTagName("link"),b=0,f=c.length;b<f;b++)0<=c[b].outerHTML.indexOf(r)&&c[b].parentNode.removeChild(c[b]);a&&(angular.element(document).find("head").append("<link rel='stylesheet' href='"+a+"'>"),r=a)};this.updateStretch=function(d){p=d;a.updateSize()};this.setSize=function(d,c){k=d;f=c;a.updateSize()};this.getSize=function(){return{width:k,height:f}};a.API=
this;a.init=function(){c.updateTheme(a.theme);a.addBindings();void 0==a.playerWidth||void 0==a.playerHeight||!0==a.responsive?(t=!0,angular.element(b).bind("resize",a.onResizeBrowser)):(l=a.playerWidth,m=a.playerHeight,c.setSize(l,m));angular.element(b)[0].fullScreenAPI&&document.addEventListener(angular.element(b)[0].fullScreenAPI.onchange,a.onFullScreenChange)};a.addBindings=function(){a.$watch("playerWidth",function(a,b){a!=b&&c.setSize(a,f)});a.$watch("playerHeight",function(a,b){a!=b&&c.setSize(k,
a)});a.$watch("theme",function(a,b){a!=b&&c.updateTheme(a)});a.$watch("stretch",function(a,b){a!=b&&c.updateStretch(a)});a.$watch("autoPlay",function(a,b){a!=b&&c.play()});a.$watch("responsive",function(d,c){d!=c&&((t=d)?(angular.element(b).bind("resize",a.onResizeBrowser),a.onResizeBrowser()):(angular.element(b).unbind("resize",a.onResizeBrowser),k=a.playerWidth,f=a.playerHeight,a.updateSize()))})};a.onElementReady=function(){v=!0;if(w)a.onPlayerReady()};a.onVideoReady=function(){w=!0;if(v)a.onPlayerReady()};
a.onPlayerReady=function(){c.videoElement[0].addEventListener("loadedmetadata",a.onLoadedMetaData);a.doPlayerReady()};a.onLoadedMetaData=function(){u=!0;a.doPlayerReady()};a.doPlayerReady=function(){if(t){var d=100*c.elementScope[0].parentNode.clientWidth/c.videoElement[0].videoWidth*c.videoElement[0].videoHeight/100;k=c.elementScope[0].parentNode.clientWidth;f=d}s=!0;a.updateSize();C&&C(c);a.$emit(e.ON_PLAYER_READY);(a.autoPlay&&!h.isMobileDevice()||n===g.PLAY)&&c.play()};a.updateSize=function(){if(s){var d,
g,h;angular.element(b)[0].fullScreenAPI&&angular.element(b)[0].fullScreenAPI.isFullScreen()||q?(c.elementScope.css("width",parseInt(window.screen.width,10)+"px"),c.elementScope.css("height",parseInt(window.screen.height,10)+"px"),d=a.getVideoSize(window.screen.width,window.screen.height),q?(l=b.innerWidth,m=b.innerHeight):(l=b.screen.width,m=b.screen.height)):(c.elementScope.css("width",parseInt(k,10)+"px"),c.elementScope.css("height",parseInt(f,10)+"px"),d=a.getVideoSize(k,f),l=k,m=f);if(0==f||isNaN(f))l=
d.width,m=d.height;0==d.width&&(d.width=k);0==d.height&&(d.height=f);h=(l-d.width)/2;g=(m-d.height)/2;c.videoElement.attr("width",parseInt(d.width,10));c.videoElement.attr("height",parseInt(d.height,10));c.videoElement.css("width",parseInt(d.width,10)+"px");c.videoElement.css("height",parseInt(d.height,10));c.videoElement.css("top",g+"px");c.videoElement.css("left",h+"px");c.elementScope.css("width",parseInt(l,10)+"px");c.elementScope.css("height",parseInt(m,10)+"px");A&&A(l,m);a.$emit(e.ON_UPDATE_SIZE,
[l,m])}};a.onResizeBrowser=function(){var d=100*c.elementScope[0].parentNode.clientWidth/c.videoElement[0].videoWidth*c.videoElement[0].videoHeight/100;k=c.elementScope[0].parentNode.clientWidth;f=d;a.updateSize()};a.onFullScreenChange=function(d){angular.element(b)[0].fullScreenAPI.isFullScreen()?a.$emit(e.ON_ENTER_FULLSCREEN):a.$emit(e.ON_EXIT_FULLSCREEN);a.updateSize();a.$apply()};a.onComplete=function(d){x&&x();c.setState(g.STOP);a.$emit(e.ON_COMPLETE);a.$apply()};a.onStartBuffering=function(d){a.$emit(e.ON_BUFFERING);
a.$apply()};a.onStartPlaying=function(d){d.target.width++;d.target.width--;a.$emit(e.ON_START_PLAYING,[d.target.duration]);a.$apply()};a.onUpdateTime=function(d){z&&z(d.target.currentTime,d.target.duration);a.$emit(e.ON_UPDATE_TIME,[d.target.currentTime,d.target.duration]);a.$apply()};a.getVideoSize=function(a,b){var f,e={};f=c.videoElement[0].videoWidth/c.videoElement[0].videoHeight>a/b;e.width=a;e.height=b;"fit"==p&&f||"fill"==p&&!f?(f=100*a/c.videoElement[0].videoWidth,e.height=c.videoElement[0].videoHeight*
f/100):"fill"==p&&f||"fit"==p&&!f?(f=100*b/c.videoElement[0].videoHeight,e.width=c.videoElement[0].videoWidth*f/100):(e.width=c.videoElement[0].videoWidth,e.height=c.videoElement[0].videoHeight);if(0==e.height||isNaN(e.height))e.width=c.elementScope[0].parentElement.clientWidth,e.height=9*e.width/16;return e};a.init()}],link:{pre:function(a,b,e,f){f.videogularElement=b;f.elementScope=angular.element(b);f.videoElement=f.elementScope.find("video");f.videoElement[0].addEventListener("waiting",a.onStartBuffering,
!1);f.videoElement[0].addEventListener("ended",a.onComplete,!1);f.videoElement[0].addEventListener("playing",a.onStartPlaying,!1);f.videoElement[0].addEventListener("timeupdate",a.onUpdateTime,!1);f.elementScope.ready(a.onElementReady);f.videoElement.ready(a.onVideoReady)}}}}]);